<% reports = @validation_report.reports.select{ |r| r.filename == name } %>

<% all_reports_2 = [] %>

<ul>
  <% @tests.each do |test_id| %>
    <% reports2 = reports.select{ |r| r.test_id == test_id } %>
    <% all_reports_2.concat(reports2) %>
    <% if reports2.present? %>
      <li>
        <strong>
          <%= link_to "http://www.chouette.mobi/neptune-validation/v22/fr/#{test_id}.html" do %>
            <%= test_id %>
          <% end %>
          <% if @default_view == :files && reports[0] %>
            <span class="cvd-ReportBlock-errorInfo">
              (<%= reports2.first.error_count %> <%= t('error_count', default: 'errors') %>)
            </span>
          <% end %>
          -
          <%= t("validation_report.details.#{test_id}") %>
        </strong>
        <%= render 'report_results_tests', { reports: reports2 } %>
      </li>
    <% end %>
  <% end %>
</ul>

<%= render 'report_results_tests', { reports: (reports - all_reports_2) } %>
